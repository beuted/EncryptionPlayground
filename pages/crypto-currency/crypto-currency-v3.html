<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

        <link href="./style/main.css" rel="stylesheet">

        <script src="./node_modules/requirejs/require.js" data-main="src/config"></script>

        <script>
            var everythingLoaded = setInterval(function() {
                if (window.AddUiInteractionsV3) {
                    clearInterval(everythingLoaded);
                    window.AddUiInteractionsV3()
                }
            }, 10);
        </script>
    </head>
    <body>
        <div class="container">
            <h1 class="h1">Agreement on the state of the blockchain</h1>

            <p>How can we address the problem of double spending? The obvious solution is that when Bob sends
            Alice a potato-coin, <b>Alice shouldn‚Äôt try to verify the transaction alone</b>. Rather, she should broadcast the
            possible transaction to the entire network of potato-coins users, and ask them to help determine whether
            the transaction is legitimate. If they collectively decide that the transaction is okay, then Alice can
            accept the potato-coin, and everyone will update their block chain. This type of protocol can help prevent
            timing attack, since if Bob tries to spend his potato-coin with both Alice and Charlie, other people on
            the network will notice, and network users will tell both Alice and Charlie that there is a problem with
            the transaction, and the transaction shouldn‚Äôt go through.</p>

            <p>In more detail, let‚Äôs suppose Bob wants to give Alice a potato-coin. As before, he signs the message
            <i>‚ÄúI, Bob, am giving Alice one potato-coin, with serial number 1234567‚Äù</i>, and gives the signed message to Alice.
            Also as before, Alice does a sanity check, using his copy of the block chain to check that, indeed, the coin
            currently belongs to Alice. But at that point the protocol is modified. Alice doesn‚Äôt just go ahead and accept
            the transaction. Instead, she broadcasts Bob‚Äôs message to the entire network. Other members of the network
            check to see whether Bob owns that potato-coin. If so, they broadcast the message <i>‚ÄúYes, Bob owns enough potato-coin for
            the transaction 1234567, it can now be transferred to Alice.‚Äù</i> Once enough people have broadcast that message,
            everyone updates their block chain to show that potato-coin now belongs to Bob through the transaction 1234567.</p>

            <div class="alert alert-success" role="alert">We are reaching here the issue that have stayed unsolved for about 30 years until somebody under the nickname of
            Satoshi Nakamoto published <a href = "https://bitcoin.org/bitcoin.pdf">a paper on the subject</a> in 2008 that will
            solve the issue of removing the "trusted 3rd party".</div>

            <p>Let's start with a simple idea, let's add a layer of verification to the system. Once Alice receive a coin from Bob
            She will first do all the checks on the hash, signature and amount of coins Bob owns we previously discussed.
            Alice will add the transaction in her blockchain <b>but will not consider yet that it is valid</b>.
            Alice will then ask all the network to validate that this translation legit or not, when Alice will receive let's say
            <b>50% of users in the network</b> responses saying that <b>the transaction is correct</b>. She will consider the transaction valid.</p>
    
            <article class="card" id="transaction-block" style="display: none;">
                <div class="card-block">
                    <ol style="margin: 0;">
                        <li><b>Transaction message:</b>
                            <code class="transaction"></code>
                        </li>

                        <li><b>Alice will then sign the message with her private key:</b>
                            <code class="signed-message"></code>
                        </li>

                        <li><b>Bob can then verify that the message is from Alice by checking the signature, check that the hash is valid and that he
                        cannot be found in his local blockchain, he finds that is is:</b>
                            <code class="verify-message"></code>
                        </li>

                        <li><b>But Bob do not consider the transaction "verified" yet. He will broadcast this message to all users in his network and ask them to verify the transaction</b>

                        <li><b>Users will respond to Bob that the message is correct considering their current blockchain</b></li>

                        <li><b>Bob can now give Alice the potato she bought him.</b>
                    </ol>
                </div>                
            </article>

            <button class="btn btn-primary" onclick="window.aliceSend1CoinToBob()">Make Alice send one coin to Bob üòá</button><br><br>
            

            <h3>Timing attacks?</h3>

            <p>Timing attack will not work anymore since Alice and Charlie will now be able to agree on which transaction is valid and which one is not.
            So when Bob will send all his coins to Alice and Charlie at the same time, only one of this transaction will be validated.</p>
            
            <p><button class="btn btn-primary btn-sm" onclick="window.broadcastSimultaneousMessages()">Simultaneously send two messages giving all Bob's money to Alice and Charlie üëø</button></p>

            <div class="alert alert-danger" role="alert">This implementation will not work either! (but we're getting close)</div>

            <p>Few issues comes with what we just discribed here:</p>
            <ol>
                <li>Alice have no way to know how many people in the network there is, so she have no way to know what
                <b>"50% of the users in the network"</b> is.</li>
                <li>Why a user will bother responding to Alice when she ask if the message she have been sent is valid?</li>                
                <li>Even if she had a way to know, Bob could create billions of fake users and swarm the network with
                puppets that will validate all his transactions. <button class="btn btn-primary btn-sm" onclick="window.swarmNetworkWithBobPuppets()">Swarm the network with bob's puppets üòà</button></li>
            </ol>

            <p>We need a better definition of: <i>‚Äúonce enough people have broadcast that message‚Äù</i> for the currency to work.</p>

            <div class="row navigation">
                <div class="col-sm-12">
                    <a class="btn btn-success float-left" href="./crypto-currency-v2.html"><< prev</a>                    
                    <a class="btn btn-success float-right" href="./crypto-currency-v4.html">next >></a>
                </div>
            </div>
        </div>

        <div class="close-network">‚ùå</div>
        <div class="network">
            <div id="Alice"></div>
            <div id="Bob"></div>
            <div id="Charlie"></div>
            <div id="Dylan"></div>
            <div id="BobPuppet1"></div>
            <div id="BobPuppet2"></div>
            <div id="BobPuppet3"></div>
            <div id="BobPuppet4"></div>
        </div>
    </body>
</html>
